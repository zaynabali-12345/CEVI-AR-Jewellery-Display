<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Minimal Ring Concept</title>

<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Lato:wght@300;400&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background-color: black;
  background-image:
    radial-gradient(at 75% 48%, #003c43 0%, transparent 70%),
    radial-gradient(at 92% 5%, #135d66 0%, transparent 60%),
    radial-gradient(at 2% 86%, #77b0aa 0%, transparent 50%),
    radial-gradient(at 96% 32%, #e3fef7 0%, transparent 40%);
  font-family: 'Lato', sans-serif;
}

/* UI ELEMENTS */
#closeBtn {
  position: fixed;
  top: 30px;
  right: 40px;
  font-family: 'Cinzel', serif;
  font-size: 14px;
  color: white;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.4);
  padding: 12px 24px;
  cursor: pointer;
  display: none;
  z-index: 10;
  letter-spacing: 2px;
  transition: all 0.4s ease;
  backdrop-filter: blur(4px);
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
  text-transform: uppercase;
}
#closeBtn:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: #fff;
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
  transform: scale(1.05);
}

/* BACKGROUND LAYERS */
.bg-layer {
  position: fixed;
  inset: 0;
  transition: opacity 1.2s ease;
  opacity: 0;
  z-index: -1;
}
.bg-layer.active {
  opacity: 1;
}

/* NEUTRAL */
#bg-neutral {
  background: transparent;
}

/* RED / GREEN / BLUE */
#bg-red {
  background: radial-gradient(circle at center, #fff5f5 0%, #eecccc 40%, #5e2a2a 90%);
}
#bg-green {
  background: radial-gradient(circle at center, #f0fff4 0%, #ccebd6 40%, #2a4d38 90%);
}
#bg-blue {
  background: radial-gradient(circle at center, #f0f8ff 0%, #ccddee 40%, #2a3b55 90%);
}

/* TEXT OVERLAYS */
.text-overlay {
  position: fixed;
  width: 100%;
  text-align: center;
  color: white;
  pointer-events: none;
  opacity: 0;
  transition: opacity 1s ease, transform 1s ease;
  z-index: 5;
}
.text-overlay.show {
  opacity: 1;
  transform: translateY(0);
}

#introText {
  top: 45%;
  font-size: 24px;
  letter-spacing: 3px;
  font-weight: 300;
}

#headerMsg {
  top: 10%;
  font-size: 20px;
  letter-spacing: 4px;
  font-family: 'Cinzel', serif;
  text-transform: uppercase;
}

#diamondContent {
  top: 20%;
  left: 10%;
  width: 30%;
  text-align: left;
}
#diamondContent h1 {
  font-size: 32px;
  margin-bottom: 10px;
  font-weight: 600;
  font-family: 'Cinzel', serif;
}
#diamondContent p {
  font-size: 16px;
  line-height: 1.6;
  opacity: 0.9;
}
</style>
</head>

<body>

<!-- BACKGROUNDS -->
<div id="bg-neutral" class="bg-layer active"></div>
<div id="bg-red" class="bg-layer"></div>
<div id="bg-green" class="bg-layer"></div>
<div id="bg-blue" class="bg-layer"></div>

<!-- UI -->
<button id="closeBtn">CLOSE</button>

<div id="introText" class="text-overlay">
  Not every diamond is the same.<br>Neither are you.
</div>

<div id="headerMsg" class="text-overlay">Choose what defines you.</div>

<div id="diamondContent" class="text-overlay">
  <h1 id="d-title">Title</h1>
  <p id="d-sub">Subtext</p>
  <p id="d-foot" style="margin-top: 30px; font-style: italic; font-size: 14px;">Footer</p>
</div>

<div id="outroText" class="text-overlay" style="bottom: 20%; font-size: 18px; letter-spacing: 2px;">
  Every colour tells a story. Which one is yours?
</div>

<a-scene
  vr-mode-ui="enabled:false"
  renderer="physicallyCorrectLights:true; alpha:true">

  <!-- GLOBAL STATE ENTITY (ECS) -->
  <a-entity id="appState" global-state></a-entity>

  <!-- CAMERA -->
  <a-entity
    camera
    position="0 1.15 3"
    fov="40"
    cursor="rayOrigin: mouse"
    raycaster="objects: .ring">
  </a-entity>

  <!-- LIGHTS -->
  <a-light type="ambient" intensity="0.8"></a-light>
  <a-light type="directional" position="2 4 3" intensity="0.6"></a-light>

  <a-entity id="ringGroup" position="0 0.85 -1.6">

  <a-entity class="ring" data-type="red" ring-focus drag-rotate-y
    gltf-model="resources/models/ring1.glb"
    position="-2.2 0 0"
    rotation="0 -90 0"
    scale="0 0 0">
    <a-light type="point" color="#ff0000" intensity="0" distance="1" position="0 0.5 0"></a-light>
  </a-entity>

  <a-entity class="ring" data-type="green" ring-focus drag-rotate-y
    gltf-model="resources/models/ring2.glb"
    position="0 0 0"
    rotation="0 -90 0"
    scale="0 0 0">
    <a-light type="point" color="#00ff00" intensity="0" distance="1" position="0 0.5 0"></a-light>
  </a-entity>

  <a-entity class="ring" data-type="blue" ring-focus drag-rotate-y
    gltf-model="resources/models/ring3.glb"
    position="2.2 0 0"
    rotation="0 -90 0"
    scale="0 0 0">
    <a-light type="point" color="#0000ff" intensity="0" distance="1" position="0 0.5 0"></a-light>
  </a-entity>

</a-entity>

</a-scene>

<script>
/* ===== UI + TEXT ELEMENTS ===== */
const closeBtn      = document.getElementById("closeBtn");
const introText     = document.getElementById("introText");
const headerMsg     = document.getElementById("headerMsg");
const diamondContent= document.getElementById("diamondContent");
const outroText     = document.getElementById("outroText");
const dTitle        = document.getElementById("d-title");
const dSub          = document.getElementById("d-sub");
const dFoot         = document.getElementById("d-foot");

/* RING CONTENT COPY */
const content = {
  red: {
    title: "Depth in Design",
    sub:   "For those who value precision,<br>clarity, and quiet strength.",
    foot:  "Defined by depth."
  },
  green: {
    title: "Balanced by Nature",
    sub:   "A statement of harmony,<br>crafted for refined confidence.",
    foot:  "Luxury in balance."
  },
  blue: {
    title: "Timeless Focus",
    sub:   "Created for minds that think deeper<br>and choose elegance that lasts.",
    foot:  "Enduring sophistication."
  }
};

/* ===== GLOBAL STATE COMPONENT ===== */
AFRAME.registerComponent('global-state', {
  init: function () {
    this.activeRing = null;
    this.isBusy = false;
    window.appState = this;
  }
});

/* ===== RING FOCUS COMPONENT ===== */
AFRAME.registerComponent('ring-focus', {
  init: function () {
    const el = this.el;

    // PBR tweak on load
    el.addEventListener("model-loaded", () => {
      el.object3D.traverse(n => {
        if (n.isMesh && n.material) {
          n.material.metalness = 0.95;
          n.material.roughness = 0.18;
          if (n.material.color) n.material.color.multiplyScalar(1.05);
        }
      });
    });

    el.addEventListener("click", () => {
      const state = window.appState;
      if (!state || state.isBusy) return;
      if (state.activeRing && state.activeRing !== el) return;
      if (el.getAttribute("visible") === false) return;

      const type = el.getAttribute("data-type");
      const data = content[type] || content.red;

      state.isBusy = true;
      state.activeRing = el;

      // background
      document.querySelectorAll('.bg-layer').forEach(bg => bg.classList.remove('active'));
      document.getElementById(`bg-${type}`).classList.add('active');

      // hide other rings
      const rings = document.querySelectorAll(".ring");
      rings.forEach(r => {
        if (r !== el) r.setAttribute('visible', false);
      });

      closeBtn.style.display = "block";
      outroText.classList.remove('show');

      el.removeAttribute("animation__resetPos");
      el.removeAttribute("animation__resetScale");
      el.removeAttribute("animation__resetRot");

      // focus animations
      el.setAttribute("animation__focus",
        "property: position; to: 0.6 0.25 0.5; dur: 700; easing: easeOutCubic");
      el.setAttribute("animation__size",
        "property: scale; to: 2.5 2.5 2.5; dur: 700; easing: easeOutCubic");

      dTitle.innerHTML = data.title;
      dSub.innerHTML   = data.sub;
      dFoot.innerHTML  = data.foot;
      diamondContent.classList.add('show');

      setTimeout(() => { state.isBusy = false; }, 750);
    });
  }
});

/* ===== DRAG ROTATE COMPONENT ===== */
AFRAME.registerComponent('drag-rotate-y', {
  init: function () {
    this.dragging = false;
    this.lastX = 0;
    this.handleMouseDown = this.onMouseDown.bind(this);
    this.handleMouseMove = this.onMouseMove.bind(this);
    this.handleMouseUp   = this.onMouseUp.bind(this);
    this.handleTouchStart= this.onTouchStart.bind(this);
    this.handleTouchMove = this.onTouchMove.bind(this);
    this.handleTouchEnd  = this.onTouchEnd.bind(this);

    document.addEventListener("mousedown", this.handleMouseDown);
    document.addEventListener("mousemove", this.handleMouseMove);
    document.addEventListener("mouseup",   this.handleMouseUp);

    document.addEventListener("touchstart", this.handleTouchStart, {passive:false});
    document.addEventListener("touchmove",  this.handleTouchMove,  {passive:false});
    document.addEventListener("touchend",   this.handleTouchEnd);
  },
  onMouseDown: function (e) {
    const state = window.appState;
    if (!state || state.activeRing !== this.el) return;
    this.dragging = true;
    this.lastX = e.clientX;
  },
  onMouseMove: function (e) {
    if (!this.dragging) return;
    const state = window.appState;
    if (!state || state.activeRing !== this.el) return;

    const dx = e.clientX - this.lastX;
    this.lastX = e.clientX;

    const r = this.el.getAttribute("rotation");
    this.el.setAttribute("rotation", {x: r.x, y: r.y + dx * 0.5, z: r.z});
  },
  onMouseUp: function () {
    this.dragging = false;
  },
  onTouchStart: function (e) {
    const state = window.appState;
    if (!state || state.activeRing !== this.el) return;
    this.dragging = true;
    this.lastX = e.touches[0].clientX;
  },
  onTouchMove: function (e) {
    if (!this.dragging) return;
    const state = window.appState;
    if (!state || state.activeRing !== this.el) return;
    e.preventDefault();
    const dx = e.touches[0].clientX - this.lastX;
    this.lastX = e.touches[0].clientX;
    const r = this.el.getAttribute("rotation");
    this.el.setAttribute("rotation", {x: r.x, y: r.y + dx * 0.5, z: r.z});
  },
  onTouchEnd: function () {
    this.dragging = false;
  },
  remove: function () {
    document.removeEventListener("mousedown", this.handleMouseDown);
    document.removeEventListener("mousemove", this.handleMouseMove);
    document.removeEventListener("mouseup",   this.handleMouseUp);
    document.removeEventListener("touchstart", this.handleTouchStart);
    document.removeEventListener("touchmove",  this.handleTouchMove);
    document.removeEventListener("touchend",   this.handleTouchEnd);
  }
});

/* ===== INTRO SEQUENCE ===== */
window.addEventListener('load', () => {
  const rings = document.querySelectorAll(".ring");

  introText.classList.add('show');

  setTimeout(() => {
    introText.classList.remove('show');
  }, 3000);

  setTimeout(() => {
    headerMsg.classList.add('show');

    // rings appear sequentially
    rings.forEach((ring, i) => {
      setTimeout(() => {
        ring.setAttribute('animation__appear',
          'property: scale; to: 1 1 1; dur: 1000; easing: easeOutBack');
        const light = ring.querySelector('a-light');
        light.setAttribute('animation__glow',
          'property: intensity; to: 0.5; dur: 800');
      }, i * 600);
    });
  }, 4000);
});

/* ===== CLOSE BUTTON ===== */
closeBtn.addEventListener("click", () => {
  const state = window.appState;
  if (!state || state.isBusy) return;
  state.isBusy = true;

  diamondContent.classList.remove('show');
  closeBtn.style.display = "none";

  const rings = document.querySelectorAll(".ring");

  rings.forEach((r, i) => {
    r.setAttribute('visible', true);

    const x = (i - 1) * 2.2;

    r.setAttribute(
      "animation__resetPos",
      `property: position; to: ${x} 0 0; dur: 1200; easing: easeInOutQuad`
    );
    r.setAttribute(
      "animation__resetScale",
      "property: scale; to: 1 1 1; dur: 1200; easing: easeInOutQuad"
    );
    r.setAttribute(
      "animation__resetRot",
      "property: rotation; to: 0 -90 0; dur: 800; easing: easeInOutQuad"
    );

    r.removeAttribute("animation__focus");
    r.removeAttribute("animation__size");
  });

  state.activeRing = null;

  document.querySelectorAll('.bg-layer').forEach(bg => bg.classList.remove('active'));
  document.getElementById('bg-neutral').classList.add('active');
  setTimeout(() => {
    outroText.classList.add('show');
    state.isBusy = false;
  }, 1200);
});
</script>

</body>
</html>
